<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fire Detection</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></script>
    <style>
        /* Slider Styles */
        .slider {
            width: 100%;
            height: 310px;
            position: relative;
            overflow: hidden;
            background: rgb(0, 0, 32);
        }

        .slide-track {
            display: flex;
            width: calc(250px * 20);
            animation: scroll 40s linear infinite;
        }

        .slide {
            width: 250px;
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: 30px;
        }

        .slide img {
            width: 250px;
            height: 250px;
            object-fit: contain;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }

        .slide:hover img {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.8);
        }

        @keyframes scroll {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(calc(-250px * 10));
            }
        }
    </style>
</head>

<body>
    <div id="navi-bar">
        <nav id="navbar">
            <span class="nav-logo" style="font-size: 1.7rem;">&#x1F525; Fire Alert</span>
            <div class="right">
                <ul>
                    <li><a href="#" id="home-link"> Home</a></li>
                    <li><a href="#description"> Description</a></li>
                    <li><a href="metrics.html" target="_blank"> Metrics</a></li>
                    <li><a href="#todo"> To Do</a></li>
                    <li><a href="#Emergency-Contact"> Emergency Contact</a></li>
                </ul>
            </div>
        </nav>
    </div>

    <main>
        <!-- First Section -->
        <section class="firstsection">
            <div class="leftsection">
                <div class="heading-container">
                    <h1 class="main-heading">Hi, this is a website for fire detection</h1>
                    <p class="sub-heading">Real-time monitoring for your safety</p>
                </div>
            </div>
            <div class="rightsection">
                <h2>ESP32 DHT Server</h2>
                <p>
                    <i class="fas fa-thermometer-half" style="color:#059e8a;"></i>
                    <span class="dht-labels">Temperature</span>
                    <span id="temperature">--</span>
                    <sup class="units">&deg;C</sup>
                </p>
                <p>
                    <i class="fas fa-tint" style="color:#00add6;"></i>
                    <span class="dht-labels">Humidity</span>
                    <span id="humidity">--</span>
                    <sup class="units">%</sup>
                </p>

                <!-- Fire Risk Visualization -->
                <h3>Fire Risk Visualization</h3>
                <div class="risk-indicator">
                    <div id="riskMarker" class="risk-marker"></div>
                </div>
                <p id="riskLevel">Risk Level: <span id="riskText">Normal</span></p>

                <button onclick="manualRefresh()" class="refresh-button">Refresh Data</button>
                <p id="update-indicator" style="display: none;">Updating...</p>
                <p id="lastUpdate"></p>
            </div>
        </section>

        <!-- Image Slider -->
        <div class="slider">
            <div class="slide-track">
                <!-- Image Slides -->
                <div class="slide"><img src="images/final_architecture_diagram.png" alt="Architecture Diagram"></div>
                <div class="slide"><img src="images/main.png" alt="Main Image"></div>
                <!-- Duplicates to create seamless looping -->
                <div class="slide"><img src="images/final_architecture_diagram.png" alt="Architecture Diagram"></div>
                <div class="slide"><img src="images/main.png" alt="Architecture Diagram"></div>
            </div>
        </div>

        <hr>
        <!-- Description Section -->
        <section id="description" class="tile-section">
            <div class="tile">
                <div class="tile-content">
                    <h1 class="gradient-heading" data-text="Description">Description</h1>
                    <p class="section-text">
                        The Fire Detection system is designed to monitor and detect fire hazards in real-time...
                    </p>
                </div>
            </div>
        </section>

        <hr>
        <!-- To Do Section -->
        <section id="todo" class="tile-section">
            <div class="tile">
                <div class="tile-content">
                    <h1 class="gradient-heading" data-text="To Do">To Do</h1>
                    <ul class="section-text">
                        <li>Stay Calm and Act Quickly</li>
                        <li>Sound the Alarm</li>
                        <li>Evacuate Immediately</li>
                        <li>Stay Low</li>
                        <li>Don't Re-enter the Building</li>
                    </ul>
                </div>
            </div>
        </section>

        <hr>
        <!-- Emergency Numbers Section -->
        <section id="Emergency-Contact" class="tile-section">
            <div class="tile">
                <div class="tile-content">
                    <h1 class="gradient-heading" data-text="Emergency Contact">Emergency Contact</h1>
                    <div class="table-container">
                        <table class="styled-table colorful-table" width="1000px" border="1px">
                            <thead>
                                <tr><th>GOVERNMENT BODY</th><th>NUMBER</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>FIRE DEPARTMENT</td><td>101</td></tr>
                                <tr><td>POLICE</td><td>100</td></tr>
                                <tr><td>AMBULANCE</td><td>108</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbz4D75EucRyuzg9QKhXnv_2lYtp7PPqqeDaM_8zR2MCTGrLdS5Rep_vlqvZdW2VjX-a/exec';

        // Fetch data from Google Sheets
        function fetchDataFromGoogleSheets() {
            fetch(GOOGLE_SHEETS_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Network response was not ok, status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Data fetched from Google Sheets:', data);

                    const temperature = data.temperature || "N/A"; // Adjust key if needed
                    const humidity = data.humidity || "N/A";       // Adjust key if needed

                    if (temperature !== "N/A" && humidity !== "N/A") {
                        document.getElementById("temperature").textContent = temperature;
                        document.getElementById("humidity").textContent = humidity;
                        updateRiskIndicator(temperature, humidity);
                    } else {
                        console.error('Temperature or humidity data not found in response:', data);
                    }
                })
                .catch(error => console.error('Error fetching data from Google Sheets:', error));
        }

        // Update the risk indicator based on fetched data
        function updateRiskIndicator(temperature, humidity) {
            const tempValue = parseFloat(temperature);
            const humidityValue = parseFloat(humidity);

            const highTempThreshold = 35;
            const highHumidityThreshold = 70;
            const lowHumidityThreshold = 30;

            let risk = 0;
            let riskText = "Normal";

            if (tempValue > highTempThreshold) risk += 50;
            if (humidityValue > highHumidityThreshold) risk += 25;
            if (humidityValue < lowHumidityThreshold) risk += 50;

            if (risk >= 75) {
                riskText = "High";
                document.getElementById("riskText").style.color = 'red';
            } else if (risk >= 50) {
                riskText = "Moderate";
                document.getElementById("riskText").style.color = 'orange';
            } else if (risk >= 25) {
                riskText = "Low";
                document.getElementById("riskText").style.color = 'yellow';
            } else {
                document.getElementById("riskText").style.color = 'green';
            }

            document.getElementById("riskText").textContent = riskText;
            document.getElementById("riskMarker").style.left = `${risk}%`;
        }

        // Manual data refresh
        function manualRefresh() {
            document.getElementById("update-indicator").style.display = "block";
            fetchDataFromGoogleSheets();
            setTimeout(() => {
                document.getElementById("update-indicator").style.display = "none";
            }, 1000);
            document.getElementById("lastUpdate").textContent = "Last updated: " + new Date().toLocaleString();
        }

        // Initial load
        manualRefresh();

        // Automatic refresh every 10 seconds
        setInterval(manualRefresh, 10000);
    </script>
</body>

</html>
