<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fire Detection Dashboard</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="navi-bar">
        <nav id="navbar">
            <span class="nav-logo" style="font-size: 1.7rem;">&#x1F525; Fire Alert</span>
            <div class="right">
                <ul>
                    <li><a href="#" id="home-link"> Home</a></li>
                    <li><a href="#description"> Description</a></li>
                    <li><a href="metrics.html" target="_blank"> Metrics</a></li>
                    <li><a href="#todo"> To Do</a></li>
                    <li><a href="#Emergency-Contact"> Emergency Contact</a></li>
                </ul>
            </div>
        </nav>
    </div>

    <main>
        <!-- Fire Detection Data Section -->
        <section class="data-section">
            <div class="data-container">
                <h2>Fire Detection Data</h2>

                <!-- Displayed Data -->
                <p>
                    <i class="fas fa-thermometer-half" style="color:#059e8a;"></i>
                    <span class="data-label">Temperature:</span>
                    <span id="temperature">--</span>
                    <sup class="units">&deg;C</sup>
                </p>
                <p>
                    <i class="fas fa-tint" style="color:#00add6;"></i>
                    <span class="data-label">Humidity:</span>
                    <span id="humidity">--</span>
                    <sup class="units">%</sup>
                </p>
                <p>
                    <i class="fas fa-exclamation-triangle" style="color:#d9534f;"></i>
                    <span class="data-label">Risk Level:</span>
                    <span id="riskText">Normal</span>
                </p>
                <p id="lastUpdate">Last updated: --</p>

                <button onclick="manualRefresh()" class="refresh-button">Refresh Data</button>
                <p id="update-indicator" style="display: none;">Updating...</p>
            </div>
        </section>

        <hr>

        <!-- Description Section -->
        <section id="description" class="tile-section">
            <div class="tile">
                <div class="tile-content">
                    <h1 class="gradient-heading" data-text="Description">Description</h1>
                    <p class="section-text">
                        The Fire Detection system monitors temperature and humidity to detect potential fire hazards in real-time.
                    </p>
                </div>
            </div>
        </section>

        <hr>
        <!-- To Do Section -->
        <section id="todo" class="tile-section">
            <div class="tile">
                <div class="tile-content">
                    <h1 class="gradient-heading" data-text="To Do">To Do</h1>
                    <ul class="section-text">
                        <li>Stay Calm and Act Quickly</li>
                        <li>Sound the Alarm</li>
                        <li>Evacuate Immediately</li>
                        <li>Stay Low</li>
                        <li>Don't Re-enter the Building</li>
                    </ul>
                </div>
            </div>
        </section>

        <hr>
        <!-- Emergency Numbers Section -->
        <section id="Emergency-Contact" class="tile-section">
            <div class="tile">
                <div class="tile-content">
                    <h1 class="gradient-heading" data-text="Emergency Contact">Emergency Contact</h1>
                    <div class="table-container">
                        <table class="styled-table colorful-table" width="1000px" border="1px">
                            <thead>
                                <tr><th>GOVERNMENT BODY</th><th>NUMBER</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>FIRE DEPARTMENT</td><td>101</td></tr>
                                <tr><td>POLICE</td><td>100</td></tr>
                                <tr><td>AMBULANCE</td><td>108</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbz4D75EucRyuzg9QKhXnv_2lYtp7PPqqeDaM_8zR2MCTGrLdS5Rep_vlqvZdW2VjX-a/exec';

        // Fetch data from Google Sheets
        function fetchDataFromGoogleSheets() {
            fetch(GOOGLE_SHEETS_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Network response was not ok, status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Data fetched from Google Sheets:', data);

                    const temperature = data.temperature || "N/A";
                    const humidity = data.humidity || "N/A";

                    if (temperature !== "N/A" && humidity !== "N/A") {
                        document.getElementById("temperature").textContent = temperature;
                        document.getElementById("humidity").textContent = humidity;
                        updateRiskIndicator(temperature, humidity);
                    } else {
                        console.error('Temperature or humidity data not found in response:', data);
                    }
                })
                .catch(error => console.error('Error fetching data from Google Sheets:', error));
        }

        // Update risk level based on fetched data
        function updateRiskIndicator(temperature, humidity) {
            const tempValue = parseFloat(temperature);
            const humidityValue = parseFloat(humidity);

            const highTempThreshold = 35;
            const highHumidityThreshold = 70;
            const lowHumidityThreshold = 30;

            let risk = 0;
            let riskText = "Normal";

            if (tempValue > highTempThreshold) risk += 50;
            if (humidityValue > highHumidityThreshold) risk += 25;
            if (humidityValue < lowHumidityThreshold) risk += 50;

            if (risk >= 75) {
                riskText = "High";
                document.getElementById("riskText").style.color = 'red';
            } else if (risk >= 50) {
                riskText = "Moderate";
                document.getElementById("riskText").style.color = 'orange';
            } else if (risk >= 25) {
                riskText = "Low";
                document.getElementById("riskText").style.color = 'yellow';
            } else {
                document.getElementById("riskText").style.color = 'green';
            }

            document.getElementById("riskText").textContent = riskText;
        }

        // Manual refresh function
        function manualRefresh() {
            document.getElementById("update-indicator").style.display = "block";
            fetchDataFromGoogleSheets();
            setTimeout(() => {
                document.getElementById("update-indicator").style.display = "none";
            }, 1000);
            document.getElementById("lastUpdate").textContent = "Last updated: " + new Date().toLocaleString();
        }

        // Initial load
        manualRefresh();

        // Automatic refresh every 10 seconds
        setInterval(manualRefresh, 10000);
    </script>
</body>

</html>
